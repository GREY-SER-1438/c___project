#include "ServerRoom2Location-4.h"
#include "Game.h"
#include <iostream>
using namespace std;

void ServerRoom2Location::run() {
    cout << "\n======================================================================================\n\n";
    game.currentLocation = &game.fuelCompartment1Location;

    if (game.serverRoom1Location.usedTerminal) {
        cout <<
             "Вы заходите глубже в серверный отсек. Жар усилился — индикаторы полыхают\n"
             "красным. Предупреждение терминала всплывает в памяти: питание нужно\n"
             "переключить на резервную линию.\n\n";
    } else {
        cout <<
             "Глубинная секция встречает горячим, плотным воздухом. Лампы мигают\n"
             "в беспорядочном ритме — что-то явно пошло не так.\n"
             "Похоже, вся панель питания здесь играет ключевую роль.\n\n";
    }

    cout <<
         "Перед вами панель питания: несколько линий, часть перегружена.\n"
         "Как действовать?\n"
         "1) Дёрнуть первый попавшийся рубильник\n"
         "2) Открыть логи системы\n";

    int powerChoice = ask({1, 2});

    if (powerChoice == 1) {
        cout <<
             "\x1B[31mВы дёргаете рубильник.\x1B[0m Вспышка — стойки гаснут.\n"
             "Короткое замыкание окончательно убивает секцию.\n"
             "Жёсткий диск с исследованиями погиб вместе с ней.\n\n";
        return;
    }

    cout <<
         "\x1B[31mВы пролистываете логи.\x1B[0m Схемы питания, ошибки охлаждения,\n"
         "маршруты обходов. Находите нужную линию и отключаете её аккуратно.\n"
         "Перегретая часть стойки временно обесточена.\n\n";

    cout <<
         "Теперь нужно вытащить жёсткий диск из перегретого блока.\n"
         "Как поступить?\n"
         "1) Попробовать стабилизировать стойку вручную\n"
         "2) Вытащить диск голыми руками\n";

    if (game.serverRoom1Location.foundCoolingModule)
        cout << "3) Вставить охлаждающий модуль\n";

    int secondChoice;

    if (game.serverRoom1Location.foundCoolingModule)
        secondChoice = ask({1, 2, 3});
    else
        secondChoice = ask({1, 2});

    if (secondChoice == 3) {
        cout <<
             "\x1B[31mВы вставляете охлаждающий модуль.\x1B[0m Температура падает почти сразу.\n"
             "Стойка стабилизируется, и вы спокойно извлекаете диск с данными.\n\n";
        game.hasResearchDisk = true;
        game.inventory.remove("cooling_module");
        game.inventory.add("hard_drive");
        return;
    }


    if (secondChoice == 1) {
        cout <<
             "\x1B[31mСтойка дрожит, металл горячий.\x1B[0m Чтобы удержать её в допуске,\n"
             "нужно перекрыть один из клапанов охлаждения.\n\n"
             "1) Правый клапан\n"
             "2) Левый клапан\n";

        int valveChoice = ask({1, 2});

        if (valveChoice == 1) {
            cout <<
                 "\x1B[31mВы закрываете правый клапан.\x1B[0m Вибрация стихает.\n"
                 "Стенки охлаждаются, стойка стабилизирована.\n"
                 "Вы извлекаете диск.\n\n";
            game.hasResearchDisk = true;
            game.inventory.add("hard_drive");
        } else {
            cout <<
                 "\x1B[31mЛевый клапан перекрыт.\x1B[0m Стойка резко вздрагивает.\n"
                 "Искры, запах озона. Короткое замыкание.\n"
                 "Диск уничтожен.\n\n";
        }
        return;
    }

    cout <<
         "\x1B[31mВы тянетесь к диску — металл обжигает.\x1B[0m В тот же момент\n"
         "стойка даёт сильный пробой. Диск сгорает мгновенно.\n\n";
}
