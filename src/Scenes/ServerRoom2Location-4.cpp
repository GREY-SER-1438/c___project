#include "ServerRoom2Location-4.h"
#include "Game.h"
#include <iostream>
using namespace std;

void ServerRoom2Location::run() {
    cout << "\n=== СЕРВЕРНАЯ — СЕКЦИЯ 2 ===\n\n";
    game.currentLocation = &game.fuelCompartment1Location;

    // === ВСТУПИТЕЛЬНЫЙ ТЕКСТ ===

    if (game.serverRoom1Location.usedTerminal) {
        cout <<
             "Вы входите в глубинную секцию серверной. С первого взгляда видно, что\n"
             "перегрев усиливается — датчики мигают красным. Вы вспоминаете предупреждение,\n"
             "что нужно переключить питание на резервную линию.\n\n";
    } else {
        cout <<
             "Вы входите в глубинную секцию серверной. Воздух плотный и горячий.\n"
             "Некоторые лампы мигают тревожно. Похоже, в стойках что-то работает не так.\n"
             "Вероятно, панель питания здесь имеет какое-то значение.\n\n";
    }


    // =====================================================================
    // === ВЫБОР 1: С КАКОЙ ЛИНИЕЙ ПИТАНИЯ РАБОТАТЬ ===
    // =====================================================================

    cout << "Перед вами панель питания. Как действовать?\n";
    cout << "1) Дёрнуть рубильник наугад\n";
    cout << "2) Просмотреть логи системы\n";

    int powerChoice = ask({1, 2});

    if (powerChoice == 1) {
        cout <<
             "\nВы дёргаете ближайший рубильник. Вспышка! Панель искрит, стойки тухнут.\n"
             "Произошло короткое замыкание — жёсткий диск безвозвратно повреждён.\n"
             "Информация об исследованиях утрачена.\n\n";
        return;
    }

    // === Игрок выбрал просмотр логов ===

    cout <<
         "\nВы просматриваете логи: маршруты питания, ошибки охлаждения, предупреждения.\n"
         "Находите нужную линию и отключаете её аккуратно.\n"
         "Перегрета часть стойки временно отключена.\n\n";


    // =====================================================================
    // === ВЫБОР 2: РЕАКЦИЯ НА ПЕРЕГРЕВ СТОЙКИ (ГДЕ ЛЕЖИТ HDD) ===
    // =====================================================================

    cout <<
         "Теперь нужно забрать жёсткий диск в перегретой стойке.\n"
         "Как действовать?\n";
    cout << "1) Временно стабилизировать стойку вручную\n";
    cout << "2) Извлечь диск голыми руками\n";

    if (game.serverRoom1Location.foundCoolingModule)
        cout << "3) Вставить охлаждающий модуль\n";

    int secondChoice;

    if (game.serverRoom1Location.foundCoolingModule)
        secondChoice = ask({1, 2, 3});
    else
        secondChoice = ask({1, 2});


    //
    // === ВАРИАНТ 2: Вставить охлаждающий модуль ===
    //
    if (secondChoice == 3) {
        cout <<
             "\nВы вставляете охлаждающий модуль. Температура стойки быстро падает.\n"
             "Без риска извлекаете жёсткий диск с данными исследований.\n\n";

        game.hasResearchDisk = true;
        return;
    }


    //
    // === ВАРИАНТ 1: Стабилизировать вручную ===
    //
    if (secondChoice == 1) {
        cout <<
             "\nСтойка вибрирует и греется. Чтобы временно стабилизировать её,\n"
             "нужно перекрыть один из клапанов охлаждения.\n\n";

        cout << "1) Закрыть правый клапан\n";
        cout << "2) Закрыть левый клапан\n";

        int valveChoice = ask({1, 2});

        if (valveChoice == 1) {
            cout <<
                 "\nВы закрываете правый клапан — вибрация утихает.\n"
                 "Стойка стабилизирована. Вы аккуратно извлекаете жёсткий диск.\n\n";

            game.hasResearchDisk = true;
        } else {
            cout <<
                 "\nВы закрываете левый клапан — стойка вздрагивает и искрит.\n"
                 "Короткое замыкание! Жёсткий диск уничтожен.\n\n";
        }
        return;
    }


    //
    // === ВАРИАНТ 2: Голыми руками ===
    //
    cout <<
         "\nВы тянетесь к диску — резкий удар током!\n"
         "Стойка коротит, диск мгновенно сгорает.\n\n";
    }
