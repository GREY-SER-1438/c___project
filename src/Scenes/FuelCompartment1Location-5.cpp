#include "FuelCompartment1Location-5.h"
#include "Game.h"
#include <iostream>
using namespace std;

void FuelCompartment1Location::run() {
    cout << "\n--- ОТСЕК С ТОПЛИВОМ (ЧАСТЬ 1) ---\n\n";

    cout <<
         "Комната полная пробитых ящиков, баков и ёмкостей с топливом.\n"
         "Помещение разваливается, свет не работает. На стенах не хватает обшивки,\n"
         "а кое-где провалился пол. В одном из углов виден проход во второй отсек,\n"
         "где хранят приспособления для транспортировки топлива.\n"
         "На стенах заметны следы копоти.\n\n";

    // --------------------------------------------------------------
    // Часть 1: осмотр (ТОЛЬКО один вариант, зависит от предмета)
    // --------------------------------------------------------------

    if (game.startLocation.tookFlashlight) {
        cout << "1) Осмотреться фонариком\n";
        ask({1});

        cout <<
             "\nВы подсвечиваете углы помещения. Среди хаоса замечаете\n"
             "пылесборный шкафчик, внутри которого виднеется СКАФАНДР.\n\n";

        game.fuelCompartment1Location.foundSpacesuit = true;
    } else {
        // NVG
        cout << "1) Осмотреться прибором ночного видения\n";
        ask({1});

        cout <<
             "\nВы включаете ПНВ. Комната выглядит пустой: стол, двери,\n"
             "сломанные ящики. Ничего необычного.\n\n";
        // Никаких предметов не найдено
    }

    // --------------------------------------------------------------
    // Часть 2: выбор стола или прохода
    // --------------------------------------------------------------
    cout <<
         "Что сделать?\n"
         "1) Осмотреть рабочий стол и инструменты\n"
         "2) Пройти дальше и поискать путь во второй отсек\n";

    int choice1 = ask({1, 2});

    if (choice1 == 1) {
        cout <<
             "\nВы подходите к столу. На нём лежат сломанные перчатки,\n"
             "разрозненные инструменты и небольшой ЗАЩИТНЫЙ МОДУЛЬ,\n"
             "используемый для безопасной работы с топливом.\n\n";
// todo
        game.fuelCompartment1Location.foundProtectionModule = true;

    } else {
        cout <<
             "\nВы решаете не тратить время на стол и сразу идёте дальше.\n"
             "В углу находится путь ко второму отсеку.\n\n";

        // Модуль НЕ найден
    }

    // --------------------------------------------------------------
    // Часть 3: тоннельный переход в генераторную
    // --------------------------------------------------------------

    cout << "1) Зайти в генераторную комнату\n";
    ask({1});

    cout <<
         "\nВы входите в маленькое техническое помещение. Панели сняты,\n"
         "кабели свисают с потолка. В центре стоит старый локальный генератор.\n\n";

    cout << "1) Восстановить локальное питание и запустить диагностику\n";
    ask({1});

    cout <<
         "\nГенератор запускается. Свет мигает и включается.\n\n"
         "=== РЕЗУЛЬТАТ ДИАГНОСТИКИ ===\n"
         "• Обнаружена авария в центральном ядре.\n"
         "• Зафиксирована локальная ВРЕМЕННАЯ АНОМАЛИЯ.\n"
         "• Станция получила критические повреждения и выгорела изнутри.\n\n"
         "Странно. Вы же только что были в серверной, и там всё выглядело целым...\n\n";

    cout << "Вы покидаете генераторную и идёте дальше.\n\n";

    game.currentLocation = &game.fuelCompartment2Location;
}
