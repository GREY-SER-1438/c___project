#include "FuelCompartment1Location-5.h"
#include "Game.h"
#include <iostream>
using namespace std;

void FuelCompartment1Location::run() {
    cout << "\n--- ОТСЕК С ТОПЛИВОМ (ЧАСТЬ 1) ---\n\n";

    cout <<
         "Комната завалена пробитыми баками, ящиками и рваными ёмкостями.\n"
         "Покрывало стен частично сорвано, иногда зияют дыры в полу.\n"
         "Света почти нет; в углах видно, как блестят потёки высохшего топлива.\n"
         "В одном углу — проход в соседний отсек, где хранятся тележки и приспособления.\n"
         "Стены и металл покрыты слоем копоти и ржавчины — следы давней разрушительной жары.\n\n";

    // --------------------------------------------------------------
    // Часть 1: осмотр (ТОЛЬКО один вариант, зависит от предмета)
    // --------------------------------------------------------------

    if (game.startLocation.tookFlashlight) {
        cout << "1) Осмотреться фонариком\n";
        ask({1});

        cout <<
             "\nВы водите лучом фонарика по складкам обломков. В тёмном углублении —\n"
             "мешковатая форма, закрытая сверху пылью. При ближайшем рассмотрении — скафандр.\n\n";

        game.fuelCompartment1Location.foundSpacesuit = true;
    } else {
        // NVG
        cout << "1) Осмотреться прибором ночного видения\n";
        ask({1});

        cout <<
             "\nВы включаете ПНВ. Пространство выглядит голым: руины, обломки, пустые карманы.\n"
             "Форма скафандра не выделяется — видимых следов той спасительной экипировки нет.\n\n";
        // Никаких предметов не найдено
    }

    // --------------------------------------------------------------
    // Часть 2: выбор стола или прохода
    // --------------------------------------------------------------
    cout <<
         "Что будете делать дальше?\n"
         "1) Осмотреть рабочий стол и инструменты\n"
         "2) Сразу пройти к проходу во второй отсек\n";

    int choice1 = ask({1, 2});

    if (choice1 == 1) {
        cout <<
             "\nЗа столом обнаруживаются вещи, заброшенные в спешке: пара изношенных перчаток,\n"
             "набор инструментов и металлический контейнер с маркировкой «PROT MODULE» — защитный модуль.\n\n"
             "1) Взять перчатки\n"
             "2) Взять инструменты\n"
             "3) Взять защитный модуль\n\n";

        cout << "Что берёте?\n";

        int itemChoice = ask({1, 2, 3});

        switch (itemChoice) {
            case 1:
                cout << "\nВы берёте перчатки. Они потрёпаны, но ещё служат защитой от копоти.\n\n";
                game.inventory.add("worn_gloves");
                break;

            case 2:
                cout << "\nВы берёте инструменты. Ничто не мешает иметь под рукой набор.\n\n";
                game.inventory.add("tools");
                break;

            case 3:
                cout << "\nВы забираете защитный модуль. Такой модуль пригодится при работе с остатками топлива.\n\n";
                game.fuelCompartment1Location.foundProtectionModule = true;
                game.inventory.add("protection");
                break;
        }

// todo переписать этот cout
    } else {
        cout <<
             "\nВы пропускаете стол и идёте к проходу. Путь к следующему отсеку открыт —\n"
             "по нему можно быстро добраться до транспортного узла.\n\n";

        // Модуль НЕ найден
    }

    // --------------------------------------------------------------
    // Часть 3: тоннельный переход в генераторную
    // --------------------------------------------------------------

    cout << "1) Войти в соседний технический отсек (генераторная)\n";
    ask({1});

    cout <<
         "\nВы проходите в маленькое техническое помещение. Панели сняты, провода свисают;\n"
         "в центре стоит старый локальный генератор — он хрипит, но откликается.\n\n";

    cout << "1) Запустить локальный генератор и произвести диагностику\n";
    ask({1});

    cout <<
         "\nГенератор запускается, свет в коридоре пробегает вспышками и стабилизируется.\n\n"
         "=== РЕЗУЛЬТАТ ДИАГНОСТИКИ ===\n"
         "• Обнаружена авария в центральном ядре: катализатор плазменного модуля повреждён.\n"
         "• Зафиксированы признаки временного сдвига в районе ядра.\n"
         "• Станция получила критические повреждения и частично выгорела.\n"
         "• Система жизнеобеспечения повреждена: отсутствует микросхема\n\n"
         "Это объясняет многое: разрушение не свежее — оно копилось годами. И теперь стало ясно, как действовать.\n"
         "Ядро может стабилизировать лишь катализатор, а систему жизнеобеспечения — микросхема.\n";

    cout << "Вы покидаете генераторную и продолжаете путь.\n\n";

    game.currentLocation = &game.fuelCompartment2Location;
}
