#include <iostream>
using namespace std;
#include "CoreLocation-8.h"
#include "Game.h"

void CoreLocation::run()
{
    cout << "\n=== ЦЕНТРАЛЬНОЕ ЯДРО ===\n";
    cout << "Вы входите в зал ядра. Пространство дрожит, линии пола и стен идут волнами.\n";
    cout << "Перед вами панель стабилизации: три слота, каждый для своего компонента.\n\n";

    bool insertedDisk = false;
    bool insertedCatalyst = false;
    bool insertedChip = false;

    // ---------------------------------------------
    // 1) ЖЁСТКИЙ ДИСК — если есть
    // ---------------------------------------------
    if (game.hasResearchDisk)
    {
        cout << "Перед вами слот для исследовательских данных.\n";
        cout << "1) Вставить жёсткий диск\n";
        ask({1});

        cout << "Диск установлен. Панель загружает данные, интерфейс оживает.\n\n";
        insertedDisk = true;
    }

    // ---------------------------------------------
    // 2) КАТАЛИЗАТОР — если есть
    // ---------------------------------------------
    if (game.catalystObtained)
    {
        cout << "Слот плазменного контура тихо вибрирует.\n";
        cout << "1) Установить плазменный катализатор\n";
        ask({1});

        cout << "Катализатор встает в паз. Контур стабилизируется, разряды гаснут.\n\n";
        insertedCatalyst = true;
    }

    // ---------------------------------------------
    // 3) МИКРОСХЕМА — если есть
    // ---------------------------------------------
    if (game.oxygenChipObtained)
    {
        cout << "Перед вами порт системы жизнеобеспечения.\n";
        cout << "1) Подключить микросхему\n";
        ask({1});

        cout << "Микросхема подключена. Фильтры запускаются, поток воздуха выравнивается.\n\n";
        insertedChip = true;
    }

    // ---------------------------------------------
    // Подсчёт
    // ---------------------------------------------
    int count = 0;
    if (insertedDisk)     count++;
    if (insertedCatalyst) count++;
    if (insertedChip)     count++;

    cout << "Панель анализирует состояние ядра...\n\n";

    // ---------------------------------------------
    // Концовка
    // ---------------------------------------------
    switch(count)
    {
        case 3: idealEnding(); break;
        case 2: twoItemsEnding(insertedDisk, insertedCatalyst, insertedChip); break;
        case 1: oneItemEnding(insertedDisk, insertedCatalyst, insertedChip); break;
        case 0: zeroItemsEnding(); break;
    }

    cout << "\n=== КОНЕЦ ИГРЫ ===\n";
    game.stop();
}



// ===============================================================
//                         К О Н Ц О В К И
// ===============================================================

void CoreLocation::idealEnding()
{
    cout <<
         "Все три компонента установлены.\n"
         "Ядро выходит на стабильный режим, аномалия схлопывается без следа.\n"
         "Вся станция постепенно приходит в равновесие, разрывы времени гаснут.\n\n"
         "Вы спасли станцию — и выжили.\n";
}



// ------------------ КОНЦОВКИ С ДВУМЯ ПРЕДМЕТАМИ ------------------

void CoreLocation::twoItemsEnding(bool disk, bool catalyst, bool chip)
{
    // 2А — Диск + Катализатор, нет микросхемы → гибель от удушья
    if (disk && catalyst && !chip)
    {
        cout <<
             "Данные сохранены, контур стабилизирован.\n"
             "Но система жизнеобеспечения так и не запущена.\n"
             "Воздух в помещении быстро портится — дым и токсичные пары усиливаются.\n\n"
             "Через несколько минут вы теряете силу говорить, затем падаете на пол.\n"
             "Вы умираете от удушья.\n";
        return;
    }

    // 2Б — Диск + Микросхема, нет катализатора → временная петля
    if (disk && chip && !catalyst)
    {
        cout <<
             "Данные загружены, воздух очищен.\n"
             "Но из-за отсутствия катализатора ядро не может стабилизировать временные потоки.\n"
             "В центре зала формируется тихая временная аномалия.\n\n"
             "Вы делаете шаг — и пространство вокруг ломается. Звук исчезает, линии размываются.\n"
             "Каждая секунда повторяется, возвращая вас к тому же мгновению.\n\n"
             "Вы больше не можете выбраться. Вы навечно застреваете во временной петле.\n";
        return;
    }

    // 2В — Катализатор + Микросхема, нет диска → герой выжил, но миссия провалена
    if (catalyst && chip && !disk)
    {
        cout <<
             "Контур стабилизирован, воздух очищен.\n"
             "Но исследовательский диск так и не был доставлен.\n\n"
             "Ядро выходит на безопасный режим, станция стабилизируется.\n"
             "Вы выживаете… но миссия полностью провалена — все исследования потеряны.\n";
        return;
    }
}



// ------------------ КОНЦОВКИ С ОДНИМ ПРЕДМЕТОМ ------------------

void CoreLocation::oneItemEnding(bool disk, bool catalyst, bool chip)
{
    // Только диск → смерть от удушья + нестабильность
    if (disk)
    {
        cout <<
             "Вы загрузили данные, но остальные системы не восстановлены.\n"
             "Пожар продолжает распространяться, воздух быстро становится токсичным.\n\n"
             "Вы кашляете всё чаще, дыхание срывается. Через несколько минут вы теряете сознание.\n"
             "Вы умираете от удушья.\n";
        return;
    }

    // Только катализатор → смерть от удушья
    if (catalyst)
    {
        cout <<
             "Контур временной стабилизации запущен, но система воздуха не функционирует.\n"
             "Зал наполняется дымом и гарью.\n\n"
             "Дыхание становится рваным, вы падаете на колени.\n"
             "Вы умираете от удушья.\n";
        return;
    }

    // Только микросхема → временная петля
    if (chip)
    {
        cout <<
             "Воздух очищается, но ядро остаётся критически нестабильным.\n"
             "Темпоральный разрыв раскрывается прямо у панели.\n\n"
             "Пространство смыкается вокруг вас, и несколько секунд начинают повторяться.\n"
             "Каждая попытка сделать шаг приводит к тому же результату.\n\n"
             "Вы заперты внутри временной петли навечно.\n";
        return;
    }
}



// ------------------ НУЛЕВАЯ КОНЦОВКА ------------------

void CoreLocation::zeroItemsEnding()
{
    cout << "Густой едкий дым быстро заполняет коридор.\n"
            "Вы вслепую ищете выход, но с каждым вдохом лёгкие обжигает сильнее.\n"
            "Силы покидают вас, колени подгибаются, и мир тонет в темноте.\n"
            "Вы умираете, задохнувшись, так и не сумев выбраться из зоны аварии.\n";
}
