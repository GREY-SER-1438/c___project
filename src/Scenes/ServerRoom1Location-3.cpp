#include "ServerRoom1Location-3.h"
#include "Game.h"
#include <iostream>
using namespace std;

void ServerRoom1Location::run() {
    cout <<
         "\x1B[31mВы входите в серверную.\x1B[0m Воздух застыл, свет мерцает, всё выглядит оставленным.\n";

    // --- ВЫБОР 1 ---
    cout <<
         "\n1) Включить терминал\n"
         "2) Не трогать терминал\n"
         "Ваш выбор:\n";

    int terminalChoice = ask({1,2});

    if (terminalChoice == 1) {
        usedTerminal = true;
        cout <<
             "\x1B[31mТерминал оживает.\x1B[0m На экране быстро появляется диагностика...\n\n"
             "Состояние станции:\n"
             "- Связь: норма\n"
             "- Повреждения: нет\n"
             "- Активность персонала: в пределах нормы\n"
             "- Внутренняя секция: ПЕРЕГРЕВ\n\n"
             "Но всё это не сходится. По данным — обычный день.\n"
             "А станция молчит уже давно.\n"
             "Логи будто застыли и не знают, что случилось после.\n";
    } else {
        cout <<
             "\x1B[31mВы оставляете терминал выключенным.\x1B[0m Комната остаётся такой же немой и пустой.\n";
    }

    // --- ВЫБОР 2 ---
    cout <<
         "\n1) Осмотреть стойки\n"
         "Ваш выбор:\n";

    int rackChoice = ask({1});

    cout <<
         "\x1B[31mВ стойках попадаются разрозненные детали:\x1B[0m\n"
         "- Охлаждающий модуль\n"
         "- Повреждённый дисплей\n"
         "- Старая клавиатура\n";

    // --- ВЫБОР 3 ---
    cout <<
         "\nЧто взять?\n"
         "1) Охлаждающий модуль\n"
         "2) Повреждённый дисплей\n"
         "3) Клавиатура\n"
         "4) Оставить всё\n"
         "Ваш выбор:\n";

    int itemChoice = ask({1,2,3,4});

    switch (itemChoice) {
        case 1:
            foundCoolingModule = true; // Флажок
            cout << "\x1B[31mВы берёте охлаждающий модуль.\x1B[0m\n";
            game.inventory.add("cooling_module");
            break;
        case 2:
            cout << "\x1B[31mВы берёте повреждённый дисплей.\x1B[0m\n";
            game.inventory.add("broken_display");
            break;
        case 3:
            cout << "\x1B[31mВы берёте клавиатуру.\x1B[0m\n";
            game.inventory.add("old_keyboard");
            break;
        case 4:
            cout << "\x1B[31mВы ничего не берёте.\x1B[0m\n";
            break;
    }

    // --- ВЫБОР 4 ---
    cout <<
         "\nПеред вами дверь с сенсорным замком.\n"
         "Можно вскрыть её быстро, но это риск.\n"
         "\n1) Открыть быстро\n"
         "2) Найти код на серверах\n"
         "Ваш выбор:\n";

    int doorChoice = ask({1,2});

    if (doorChoice == 1) {
        cout <<
             "\x1B[31mВы решаетесь на быстрый взлом...\x1B[0m\n"
             "Искра — стойки гаснут. Произошло короткое замыкание.\n"
             "Доступ к исследовательскому диску потерян.\n";
        game.currentLocation = &game.fuelCompartment1Location;
        return;
    }

    cout <<
         "\x1B[31mВы ищете рабочий блок...\x1B[0m\n"
         "Один сервер отвечает, и вы находите нужный код.\n"
         "Дверь плавно открывается.\n";

    game.currentLocation = &game.serverRoom2Location;
}
